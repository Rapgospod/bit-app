<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <title>Bit Them All ‚Äî Tap</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root{
      --bg1:#0b0b0c;
      --bg2:#141417;
      --card:#1b1b1f;
      --muted:#a9a9b2;
      --accent:#00ff99;
      --warn:#ffcc00;
      --shadow: 0 16px 40px rgba(0,0,0,.45);
      --radius: 18px;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: Arial, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      color:#fff;
      background: radial-gradient(1200px 700px at 50% 0%, #1f1f25 0%, var(--bg1) 55%, #070708 100%);
      min-height:100vh;
      padding: 18px 16px 28px;
      display:flex;
      justify-content:center;
    }

    .wrap{
      width:min(420px, 100%);
    }

    .top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom:14px;
    }

    .title{
      font-size:18px;
      line-height:1.2;
      margin:0;
      font-weight:700;
      letter-spacing:.2px;
    }
    .sub{
      margin:4px 0 0;
      color:var(--muted);
      font-size:12px;
    }

    .pill{
      padding:8px 10px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.08);
      border-radius: 999px;
      font-size:12px;
      color:#e9e9f0;
      box-shadow: 0 10px 28px rgba(0,0,0,.25);
      white-space:nowrap;
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border: 1px solid rgba(255,255,255,.09);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 16px;
      backdrop-filter: blur(10px);
    }

    .stats{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
      margin-bottom:12px;
    }

    .stat .label{
      color:var(--muted);
      font-size:12px;
      margin-bottom:6px;
      display:flex;
      align-items:center;
      gap:6px;
    }
    .stat .value{
      font-size:34px;
      font-weight:800;
      letter-spacing:.5px;
    }

    .tapArea{
      margin-top:12px;
      position:relative;
      overflow:hidden;
      padding: 18px 14px;
    }

    .bunnyWrap{
      position:relative;
      width: 190px;
      height: 190px;
      margin: 8px auto 10px;
      display:grid;
      place-items:center;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }

    .bunnyGlow{
      position:absolute;
      inset:-18px;
      border-radius: 999px;
      background: radial-gradient(circle at 50% 50%, rgba(0,255,153,.22), rgba(0,255,153,.05), transparent 70%);
      filter: blur(2px);
      opacity:.9;
      pointer-events:none;
    }

    #bunny{
      width: 170px;
      height: 170px;
      object-fit: contain;
      border-radius: 24px;
      filter: drop-shadow(0 18px 36px rgba(0,0,0,.55));
      transform: translateZ(0);
      transition: transform .08s ease;
      will-change: transform;
    }

    .bunnyWrap:active #bunny{
      transform: scale(0.97);
    }

    .shake{
      animation: shake .22s ease;
    }
    @keyframes shake{
      0%{ transform: translateY(0) scale(1); }
      30%{ transform: translateY(-8px) scale(1.03); }
      65%{ transform: translateY(2px) scale(0.99); }
      100%{ transform: translateY(0) scale(1); }
    }

    .cta{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:center;
      margin-top: 10px;
      flex-wrap:wrap;
    }

    .btn{
      background: var(--accent);
      color:#062014;
      border: none;
      border-radius: 14px;
      padding: 14px 18px;
      font-weight:800;
      font-size:16px;
      cursor:pointer;
      box-shadow: 0 16px 40px rgba(0,255,153,.18);
      min-width: 170px;
    }
    .btn:active{ transform: scale(0.98); }

    .btn.secondary{
      background: rgba(255,255,255,.06);
      color:#fff;
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: none;
      min-width: 120px;
      font-weight:700;
    }

    .energyLine{
      margin-top: 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      color: var(--muted);
      font-size:12px;
    }

    .bar{
      margin-top: 8px;
      height: 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.07);
      border: 1px solid rgba(255,255,255,.10);
      overflow:hidden;
    }
    .bar > div{
      height:100%;
      width: 50%;
      background: linear-gradient(90deg, rgba(0,255,153,.95), rgba(0,255,153,.55));
      border-radius: 999px;
      transition: width .25s ease;
    }

    .hint{
      margin: 12px 0 0;
      color: rgba(255,255,255,.75);
      font-size: 12px;
      line-height: 1.45;
    }

    /* floating +1 */
    .float{
      position:absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      font-weight: 900;
      font-size: 18px;
      color: var(--accent);
      text-shadow: 0 10px 26px rgba(0,255,153,.25);
      pointer-events:none;
      opacity: 0;
      animation: floatUp .75s ease forwards;
      will-change: transform, opacity;
    }
    @keyframes floatUp{
      0%{ opacity: 0; transform: translate(-50%, -10%) scale(.9); }
      15%{ opacity: 1; }
      100%{ opacity: 0; transform: translate(-50%, -130%) scale(1.2); }
    }

    .toast{
      margin-top:10px;
      font-size:12px;
      color: var(--warn);
      min-height: 16px;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div>
        <p class="title" id="username">Welcome</p>
        <p class="sub">Bit Them All ‚Ä¢ tap-game prototype</p>
      </div>
      <div class="pill" id="netPill">offline progress</div>
    </div>

    <div class="stats">
      <div class="card stat">
        <div class="label">üí∞ BIT Balance</div>
        <div class="value" id="balance">0</div>
      </div>
      <div class="card stat">
        <div class="label">‚ö° Energy</div>
        <div class="value"><span id="energy">10</span><span style="font-size:14px;color:var(--muted);font-weight:700"> /10</span></div>
      </div>
    </div>

    <div class="card tapArea" id="tapArea">
      <div class="bunnyWrap" id="bunnyWrap" aria-label="Tap bunny">
        <div class="bunnyGlow"></div>
        <!-- ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–ê–Ø raw —Å—Å—ã–ª–∫–∞ (–∏–∑ —Ç–≤–æ–µ–≥–æ permalink) -->
        <img id="bunny" src="https://raw.githubusercontent.com/Rapgospod/bit-app/6b2bcc75348d5bc50380e7accb13a438d623d9db/pepebunny.png" alt="pepebunny" />
      </div>

      <div class="cta">
        <button class="btn" id="bitBtn">‚ö° TAP BIT</button>
        <button class="btn secondary" id="resetBtn">Reset</button>
      </div>

      <div class="energyLine">
        <span>regen: +1 energy / 3s</span>
        <span id="regenState">ready</span>
      </div>
      <div class="bar"><div id="energyBar"></div></div>

      <div class="toast" id="toast"></div>
      <div class="hint">–¢–∞–ø–∞–π –±–∞–Ω–Ω–∏ –∏–ª–∏ –∫–Ω–æ–ø–∫—É. –ü—Ä–æ–≥—Ä–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ —Ç–≤–æ—ë–º –±—Ä–∞—É–∑–µ—Ä–µ (localStorage). –î–∞–ª—å—à–µ –¥–æ–±–∞–≤–∏–º –∞–ø–≥—Ä–µ–π–¥—ã/–∫–≤–µ—Å—Ç—ã/–±–æ–Ω—É—Å—ã.</div>
    </div>
  </div>

  <script>
    const tg = window.Telegram?.WebApp;
    if (tg) tg.expand();

    const user = tg?.initDataUnsafe?.user;
    const usernameEl = document.getElementById("username");
    usernameEl.textContent = "Welcome" + (user?.first_name ? ", " + user.first_name : ", Degen");

    // UI elements
    const balanceEl = document.getElementById("balance");
    const energyEl = document.getElementById("energy");
    const energyBar = document.getElementById("energyBar");
    const toast = document.getElementById("toast");
    const regenState = document.getElementById("regenState");
    const bunnyWrap = document.getElementById("bunnyWrap");
    const tapArea = document.getElementById("tapArea");
    const netPill = document.getElementById("netPill");

    const MAX_ENERGY = 10;
    const REGEN_MS = 3000;

    // state
    let balance = Number(localStorage.getItem("balance") || 0);
    let energy  = Number(localStorage.getItem("energy")  || MAX_ENERGY);

    function save(){
      localStorage.setItem("balance", String(balance));
      localStorage.setItem("energy", String(energy));
    }

    function render(){
      balanceEl.textContent = balance;
      energyEl.textContent = energy;
      energyBar.style.width = `${(energy / MAX_ENERGY) * 100}%`;
      netPill.textContent = tg ? "tg mini app" : "browser preview";
    }

    function vibrate(){
      try { tg?.HapticFeedback?.impactOccurred("light"); } catch(e){}
      try { navigator.vibrate?.(15); } catch(e){}
    }

    function floatText(x, y, text){
      const el = document.createElement("div");
      el.className = "float";
      el.textContent = text;

      // position relative to tapArea
      const rect = tapArea.getBoundingClientRect();
      const px = x - rect.left;
      const py = y - rect.top;

      el.style.left = px + "px";
      el.style.top  = py + "px";
      el.style.transform = "translate(-50%, -50%)";
      tapArea.appendChild(el);

      setTimeout(() => el.remove(), 800);
    }

    function bunnyPop(){
      bunnyWrap.classList.remove("shake");
      // force reflow to restart animation
      void bunnyWrap.offsetWidth;
      bunnyWrap.classList.add("shake");
    }

    function showToast(msg){
      toast.textContent = msg || "";
      if (!msg) return;
      clearTimeout(showToast._t);
      showToast._t = setTimeout(()=> toast.textContent="", 900);
    }

    function tap(x, y){
      if (energy <= 0){
        showToast("No energy üòµ wait regen...");
        return;
      }
      balance += 1;
      energy  -= 1;
      save();
      render();
      vibrate();
      bunnyPop();
      floatText(x, y, "+1 BIT");
    }

    // button tap
    document.getElementById("bitBtn").addEventListener("click", (e)=>{
      const r = tapArea.getBoundingClientRect();
      tap(r.left + r.width/2, r.top + r.height/2);
    });

    // tap bunny (mouse)
    bunnyWrap.addEventListener("click", (e)=>{
      tap(e.clientX, e.clientY);
    });

    // tap bunny (touch) ‚Äî —á—Ç–æ–± –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –±—ã–ª–∏ —Ç–æ—á–Ω—ã–µ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ
    bunnyWrap.addEventListener("touchstart", (e)=>{
      const t = e.touches?.[0];
      if (!t) return;
      tap(t.clientX, t.clientY);
    }, {passive:true});

    // reset
    document.getElementById("resetBtn").addEventListener("click", ()=>{
      balance = 0;
      energy = MAX_ENERGY;
      save();
      render();
      showToast("Reset ‚úÖ");
      try { tg?.HapticFeedback?.notificationOccurred("success"); } catch(e){}
    });

    // regen
    setInterval(()=>{
      if (energy < MAX_ENERGY){
        energy += 1;
        save();
        render();
        regenState.textContent = "regen +1";
        setTimeout(()=> regenState.textContent="ready", 350);
      }
    }, REGEN_MS);

    render();
  </script>
</body>
</html>